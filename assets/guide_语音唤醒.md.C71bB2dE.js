import{_ as i,c as a,o as n,ae as t}from"./chunks/framework.BGWP4WZ_.js";const E=JSON.parse('{"title":"语音唤醒功能","description":"","frontmatter":{},"headers":[],"relativePath":"guide/语音唤醒.md","filePath":"guide/语音唤醒.md"}'),h={name:"guide/语音唤醒.md"};function l(p,s,e,k,d,r){return n(),a("div",null,s[0]||(s[0]=[t(`<h1 id="语音唤醒功能" tabindex="-1">语音唤醒功能 <a class="header-anchor" href="#语音唤醒功能" aria-label="Permalink to &quot;语音唤醒功能&quot;">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>py-xiaozhi 集成了基于 <strong>Sherpa-ONNX</strong> 的高精度语音唤醒功能，支持自定义唤醒词和实时检测。使用轻量级关键词检测模型，提供毫秒级响应速度。</p><h2 id="唤醒词模型" tabindex="-1">唤醒词模型 <a class="header-anchor" href="#唤醒词模型" aria-label="Permalink to &quot;唤醒词模型&quot;">​</a></h2><h3 id="模型下载-必需" tabindex="-1">模型下载（必需） <a class="header-anchor" href="#模型下载-必需" aria-label="Permalink to &quot;模型下载（必需）&quot;">​</a></h3><p><strong>重要说明</strong>: 项目不包含模型文件，需要提前下载配置。</p><h3 id="官方模型下载地址" tabindex="-1">官方模型下载地址 <a class="header-anchor" href="#官方模型下载地址" aria-label="Permalink to &quot;官方模型下载地址&quot;">​</a></h3><ul><li><strong>官方模型列表</strong>: <a href="https://csukuangfj.github.io/sherpa/onnx/kws/pretrained_models/index.html" target="_blank" rel="noreferrer">https://csukuangfj.github.io/sherpa/onnx/kws/pretrained_models/index.html</a></li><li><strong>推荐模型</strong>: <code>sherpa-onnx-kws-zipformer-wenetspeech-3.3M-2024-01-01</code></li></ul><h3 id="下载和配置步骤" tabindex="-1">下载和配置步骤 <a class="header-anchor" href="#下载和配置步骤" aria-label="Permalink to &quot;下载和配置步骤&quot;">​</a></h3><h4 id="_1-下载模型包" tabindex="-1">1. 下载模型包 <a class="header-anchor" href="#_1-下载模型包" aria-label="Permalink to &quot;1. 下载模型包&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 方法1：直接下载（推荐）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /Users/junsen/Desktop/workspace/py-xiaozhi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/k2-fsa/sherpa-onnx/releases/download/kws-models/sherpa-onnx-kws-zipformer-wenetspeech-3.3M-2024-01-01.tar.bz2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 解压</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sherpa-onnx-kws-zipformer-wenetspeech-3.3M-2024-01-01.tar.bz2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 方法2：使用ModelScope</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> modelscope</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">from modelscope import snapshot_download</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">snapshot_download(&#39;pkufool/sherpa-onnx-kws-zipformer-wenetspeech-3.3M-2024-01-01&#39;, cache_dir=&#39;./models&#39;)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><h4 id="_2-配置模型文件" tabindex="-1">2. 配置模型文件 <a class="header-anchor" href="#_2-配置模型文件" aria-label="Permalink to &quot;2. 配置模型文件&quot;">​</a></h4><p>模型包下载后包含以下文件：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sherpa-onnx-kws-zipformer-wenetspeech-3.3M-2024-01-01/</span></span>
<span class="line"><span>├── encoder-epoch-12-avg-2-chunk-16-left-64.int8.onnx    # 速度优先</span></span>
<span class="line"><span>├── encoder-epoch-12-avg-2-chunk-16-left-64.onnx         # </span></span>
<span class="line"><span>├── encoder-epoch-99-avg-1-chunk-16-left-64.int8.onnx    # 速度优先 </span></span>
<span class="line"><span>├── encoder-epoch-99-avg-1-chunk-16-left-64.onnx         # 精度优先</span></span>
<span class="line"><span>├── decoder-epoch-12-avg-2-chunk-16-left-64.onnx         #</span></span>
<span class="line"><span>├── decoder-epoch-99-avg-1-chunk-16-left-64.onnx         # 精度优先</span></span>
<span class="line"><span>├── joiner-epoch-12-avg-2-chunk-16-left-64.int8.onnx     # 速度优先</span></span>
<span class="line"><span>├── joiner-epoch-12-avg-2-chunk-16-left-64.onnx          #</span></span>
<span class="line"><span>├── joiner-epoch-99-avg-1-chunk-16-left-64.int8.onnx     # 速度优先</span></span>
<span class="line"><span>├── joiner-epoch-99-avg-1-chunk-16-left-64.onnx          # 精度优先</span></span>
<span class="line"><span>├── tokens.txt                    # Token映射表（必需）</span></span>
<span class="line"><span>├── keywords_raw.txt              # 原始关键词（可选，用于生成）</span></span>
<span class="line"><span>├── keywords.txt                  # 现成的</span></span>
<span class="line"><span>├── test_wavs/                    # 测试音频（可选）</span></span>
<span class="line"><span>├── configuration.json            # 模型元信息（可选）</span></span>
<span class="line"><span>└── README.md                     # 说明文档（可选）</span></span></code></pre></div><h4 id="_3-选择配置方案" tabindex="-1">3. 选择配置方案 <a class="header-anchor" href="#_3-选择配置方案" aria-label="Permalink to &quot;3. 选择配置方案&quot;">​</a></h4><p><strong>方案一：精度优先（推荐）</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sherpa-onnx-kws-zipformer-wenetspeech-3.3M-2024-01-01</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 复制精度优先的epoch-99 fp32三件套</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> encoder-epoch-99-avg-1-chunk-16-left-64.onnx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../models/encoder.onnx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> decoder-epoch-99-avg-1-chunk-16-left-64.onnx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../models/decoder.onnx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> joiner-epoch-99-avg-1-chunk-16-left-64.onnx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../models/joiner.onnx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 复制配套文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tokens.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../models/tokens.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> keywords_raw.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../models/keywords_raw.txt</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 可选</span></span></code></pre></div><p><strong>方案二：速度优先</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sherpa-onnx-kws-zipformer-wenetspeech-3.3M-2024-01-01</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 复制速度优先的epoch-99 int8三件套</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> encoder-epoch-99-avg-1-chunk-16-left-64.int8.onnx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../models/encoder.onnx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> decoder-epoch-99-avg-1-chunk-16-left-64.onnx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../models/decoder.onnx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> joiner-epoch-99-avg-1-chunk-16-left-64.int8.onnx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../models/joiner.onnx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 复制配套文件  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tokens.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../models/tokens.txt</span></span></code></pre></div><p><strong>注意事项</strong>:</p><ul><li><strong>不要混用fp32与int8</strong>：三个模型文件必须保持一致的精度</li><li><strong>优先选择epoch-99</strong>：比epoch-12训练更充分，精度更高</li><li><strong>必需文件</strong>：<code>encoder.onnx</code> + <code>decoder.onnx</code> + <code>joiner.onnx</code> + <code>tokens.txt</code> + <code>keywords.txt</code></li></ul><h3 id="最终模型文件结构" tabindex="-1">最终模型文件结构 <a class="header-anchor" href="#最终模型文件结构" aria-label="Permalink to &quot;最终模型文件结构&quot;">​</a></h3><p>配置完成后，你的models目录应该包含：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>models/</span></span>
<span class="line"><span>├── encoder.onnx      # 编码器模型（重命名后）</span></span>
<span class="line"><span>├── decoder.onnx      # 解码器模型（重命名后） </span></span>
<span class="line"><span>├── joiner.onnx       # 连接器模型（重命名后）</span></span>
<span class="line"><span>├── tokens.txt        # 拼音Token映射表（228行版本）</span></span>
<span class="line"><span>├── keywords.txt      # 关键词配置文件（需创建）</span></span>
<span class="line"><span>└── keywords_raw.txt  # 原始关键词文件（可选）</span></span></code></pre></div><h3 id="模型性能对比" tabindex="-1">模型性能对比 <a class="header-anchor" href="#模型性能对比" aria-label="Permalink to &quot;模型性能对比&quot;">​</a></h3><table tabindex="0"><thead><tr><th>模型版本</th><th>文件大小</th><th>推理速度</th><th>识别精度</th><th>资源占用</th><th>推荐场景</th></tr></thead><tbody><tr><td><strong>epoch-99 fp32</strong></td><td>~13MB</td><td>中等</td><td>最高</td><td>中等</td><td><strong>桌面电脑（推荐）</strong></td></tr><tr><td><strong>epoch-99 int8</strong></td><td>~4MB</td><td>快</td><td>高</td><td>低</td><td>移动设备/资源受限</td></tr><tr><td><strong>epoch-12 fp32</strong></td><td>~13MB</td><td>中等</td><td>中高</td><td>中等</td><td>一般使用</td></tr><tr><td><strong>epoch-12 int8</strong></td><td>~4MB</td><td>最快</td><td>中等</td><td>最低</td><td>极速响应需求</td></tr></tbody></table><h2 id="启用语音唤醒" tabindex="-1">启用语音唤醒 <a class="header-anchor" href="#启用语音唤醒" aria-label="Permalink to &quot;启用语音唤醒&quot;">​</a></h2><h3 id="配置文件设置" tabindex="-1">配置文件设置 <a class="header-anchor" href="#配置文件设置" aria-label="Permalink to &quot;配置文件设置&quot;">​</a></h3><p>编辑 <code>config/config.json</code>：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;WAKE_WORD_OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;USE_WAKE_WORD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;MODEL_PATH&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;models&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;NUM_THREADS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;PROVIDER&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cpu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;MAX_ACTIVE_PATHS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_SCORE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_THRESHOLD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;NUM_TRAILING_BLANKS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="配置参数详解" tabindex="-1">配置参数详解 <a class="header-anchor" href="#配置参数详解" aria-label="Permalink to &quot;配置参数详解&quot;">​</a></h3><table tabindex="0"><thead><tr><th>参数</th><th>默认值</th><th>说明</th><th>调优建议</th></tr></thead><tbody><tr><td><code>USE_WAKE_WORD</code></td><td><code>true</code></td><td>启用语音唤醒功能</td><td>-</td></tr><tr><td><code>MODEL_PATH</code></td><td><code>&quot;models&quot;</code></td><td>模型文件目录</td><td>确保路径正确</td></tr><tr><td><code>NUM_THREADS</code></td><td><code>4</code></td><td>处理线程数</td><td>电脑性能好可设置6-8</td></tr><tr><td><code>PROVIDER</code></td><td><code>&quot;cpu&quot;</code></td><td>推理引擎</td><td>可选: cpu, cuda, coreml</td></tr><tr><td><code>MAX_ACTIVE_PATHS</code></td><td><code>2</code></td><td>搜索路径数</td><td>减少提升速度，增加提升准确性</td></tr><tr><td><code>KEYWORDS_SCORE</code></td><td><code>1.8</code></td><td>关键词增强分数</td><td>提高减少误检，降低提升灵敏度</td></tr><tr><td><code>KEYWORDS_THRESHOLD</code></td><td><code>0.2</code></td><td>检测阈值</td><td>降低提升灵敏度，提高减少误检</td></tr><tr><td><code>NUM_TRAILING_BLANKS</code></td><td><code>1</code></td><td>尾随空白数量</td><td>通常保持1</td></tr></tbody></table><h2 id="自定义唤醒词" tabindex="-1">自定义唤醒词 <a class="header-anchor" href="#自定义唤醒词" aria-label="Permalink to &quot;自定义唤醒词&quot;">​</a></h2><h3 id="当前支持的唤醒词" tabindex="-1">当前支持的唤醒词 <a class="header-anchor" href="#当前支持的唤醒词" aria-label="Permalink to &quot;当前支持的唤醒词&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 小爱同学    (x iǎo ài t óng x ué)</span></span>
<span class="line"><span>2. 你好问问    (n ǐ h ǎo w èn w èn)</span></span>
<span class="line"><span>3. 小艺小艺    (x iǎo y ì x iǎo y ì)</span></span>
<span class="line"><span>4. 小米小米    (x iǎo m ǐ x iǎo m ǐ)</span></span>
<span class="line"><span>5. 你好小智 (n ǐ h ǎo x iǎo zh ì)</span></span>
<span class="line"><span>6. 贾维斯 (j iā w éi s ī)</span></span></code></pre></div><h3 id="添加新唤醒词" tabindex="-1">添加新唤醒词 <a class="header-anchor" href="#添加新唤醒词" aria-label="Permalink to &quot;添加新唤醒词&quot;">​</a></h3><h4 id="方法1-编辑关键词文件" tabindex="-1">方法1: 编辑关键词文件 <a class="header-anchor" href="#方法1-编辑关键词文件" aria-label="Permalink to &quot;方法1: 编辑关键词文件&quot;">​</a></h4><p>编辑 <code>models/keywords.txt</code>，按格式添加：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 格式：拼音分解 @中文原文</span></span>
<span class="line"><span>x iǎo zh ì @小智</span></span>
<span class="line"><span>n ǐ h ǎo x iǎo zh ì @你好小智</span></span>
<span class="line"><span>j iā w éi s ī @贾维斯</span></span>
<span class="line"><span>k āi sh ǐ g ōng z uò @开始工作</span></span></code></pre></div><h4 id="方法2-使用拼音转换工具" tabindex="-1">方法2: 使用拼音转换工具 <a class="header-anchor" href="#方法2-使用拼音转换工具" aria-label="Permalink to &quot;方法2: 使用拼音转换工具&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pypinyin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lazy_pinyin, Style</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate_keyword_line</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pinyin_list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lazy_pinyin(text, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Style.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TONE3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">neutral_tone_with_five</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    processed_pinyin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [py.rstrip(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;12345&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> py </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pinyin_list]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pinyin_str </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39; &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(processed_pinyin)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pinyin_str</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成新唤醒词</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wake_words </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;小助手&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;开始工作&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;星期五&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> word </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wake_words:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(generate_keyword_line(word))</span></span></code></pre></div><h3 id="唤醒词选择建议" tabindex="-1">唤醒词选择建议 <a class="header-anchor" href="#唤醒词选择建议" aria-label="Permalink to &quot;唤醒词选择建议&quot;">​</a></h3><h4 id="推荐的唤醒词特点" tabindex="-1">推荐的唤醒词特点 <a class="header-anchor" href="#推荐的唤醒词特点" aria-label="Permalink to &quot;推荐的唤醒词特点&quot;">​</a></h4><ul><li><strong>长度适中</strong>: 2-4个字符</li><li><strong>发音清晰</strong>: 避免相似音混淆</li><li><strong>独特性强</strong>: 避免日常对话常用词</li><li><strong>朗朗上口</strong>: 容易记忆和发音</li></ul><h4 id="示例好的唤醒词" tabindex="-1">示例好的唤醒词 <a class="header-anchor" href="#示例好的唤醒词" aria-label="Permalink to &quot;示例好的唤醒词&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>- 你好小智    # 4字，独特，清晰</span></span>
<span class="line"><span>- 贾维斯      # 3字，独特，科技感</span></span>
<span class="line"><span>- 开始工作    # 4字，明确意图</span></span>
<span class="line"><span>- 小助手      # 3字，简单易记</span></span></code></pre></div><h4 id="避免使用" tabindex="-1">避免使用 <a class="header-anchor" href="#避免使用" aria-label="Permalink to &quot;避免使用&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>- 嗯         # 太短，容易误触</span></span>
<span class="line"><span>- 你好       # 太常用</span></span>
<span class="line"><span>- 请帮我做一个计划 # 太长</span></span>
<span class="line"><span>- 谢谢       # 日常用语</span></span></code></pre></div><h2 id="使用方法" tabindex="-1">使用方法 <a class="header-anchor" href="#使用方法" aria-label="Permalink to &quot;使用方法&quot;">​</a></h2><h3 id="启动流程" tabindex="-1">启动流程 <a class="header-anchor" href="#启动流程" aria-label="Permalink to &quot;启动流程&quot;">​</a></h3><ol><li><p><strong>启动程序</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /Users/junsen/Desktop/workspace/py-xiaozhi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main.py</span></span></code></pre></div></li><li><p><strong>模型加载</strong>：</p><ul><li>系统自动加载Sherpa-ONNX模型</li><li>初始化关键词检测器</li><li>进入唤醒词监听状态</li></ul></li><li><p><strong>语音唤醒</strong>：</p><ul><li>清晰说出配置的唤醒词</li><li>系统自动切换到LISTENING状态</li><li>开始语音对话</li></ul></li></ol><h3 id="使用技巧" tabindex="-1">使用技巧 <a class="header-anchor" href="#使用技巧" aria-label="Permalink to &quot;使用技巧&quot;">​</a></h3><h4 id="最佳唤醒方式" tabindex="-1">最佳唤醒方式 <a class="header-anchor" href="#最佳唤醒方式" aria-label="Permalink to &quot;最佳唤醒方式&quot;">​</a></h4><ul><li><strong>音量适中</strong>: 正常说话音量</li><li><strong>语速自然</strong>: 不要太快或太慢</li><li><strong>发音清晰</strong>: 特别注意声调</li><li><strong>环境安静</strong>: 减少背景噪音</li></ul><h2 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h2><h3 id="速度优化配置" tabindex="-1">速度优化配置 <a class="header-anchor" href="#速度优化配置" aria-label="Permalink to &quot;速度优化配置&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;WAKE_WORD_OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;NUM_THREADS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 提高线程数</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;MAX_ACTIVE_PATHS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 减少搜索路径</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_THRESHOLD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 降低阈值提高灵敏度</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_SCORE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 降低分数提升速度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="精度优化配置" tabindex="-1">精度优化配置 <a class="header-anchor" href="#精度优化配置" aria-label="Permalink to &quot;精度优化配置&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;WAKE_WORD_OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;NUM_THREADS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 适中线程数</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;MAX_ACTIVE_PATHS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 增加搜索路径</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_THRESHOLD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 提高阈值减少误检</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_SCORE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 提高分数增强准确性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="性能监控" tabindex="-1">性能监控 <a class="header-anchor" href="#性能监控" aria-label="Permalink to &quot;性能监控&quot;">​</a></h3><p>检查当前性能：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在应用中查看统计信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stats </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wake_word_detector.get_performance_stats()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;引擎: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stats[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;engine&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;线程数: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stats[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;num_threads&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;检测阈值: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stats[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;keywords_threshold&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;运行状态: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stats[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;is_running&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to &quot;故障排除&quot;">​</a></h2><h3 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h3><h4 id="_1-唤醒词无响应" tabindex="-1">1. 唤醒词无响应 <a class="header-anchor" href="#_1-唤醒词无响应" aria-label="Permalink to &quot;1. 唤醒词无响应&quot;">​</a></h4><p><strong>症状</strong>: 说出唤醒词没有反应</p><p><strong>解决方案</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;WAKE_WORD_OPTIONS&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config/config.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查模型文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> models/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试功能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_new_keywords.py</span></span></code></pre></div><h4 id="_2-响应速度慢" tabindex="-1">2. 响应速度慢 <a class="header-anchor" href="#_2-响应速度慢" aria-label="Permalink to &quot;2. 响应速度慢&quot;">​</a></h4><p><strong>症状</strong>: 唤醒词识别延迟大</p><p><strong>解决方案</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;WAKE_WORD_OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_THRESHOLD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 降低阈值</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;NUM_THREADS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 增加线程</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;MAX_ACTIVE_PATHS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 减少搜索路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="_3-误检频繁" tabindex="-1">3. 误检频繁 <a class="header-anchor" href="#_3-误检频繁" aria-label="Permalink to &quot;3. 误检频繁&quot;">​</a></h4><p><strong>症状</strong>: 经常误触发唤醒</p><p><strong>解决方案</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;WAKE_WORD_OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_THRESHOLD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 提高阈值</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_SCORE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 提高分数</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;MAX_ACTIVE_PATHS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 增加搜索路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="_4-模型加载失败" tabindex="-1">4. 模型加载失败 <a class="header-anchor" href="#_4-模型加载失败" aria-label="Permalink to &quot;4. 模型加载失败&quot;">​</a></h4><p><strong>症状</strong>: 启动时报模型文件错误</p><p><strong>解决方案</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查文件完整性</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -la</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> models/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> models/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.onnx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> models/tokens.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重新验证模型</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_new_keywords.py</span></span></code></pre></div><h3 id="调试命令" tabindex="-1">调试命令 <a class="header-anchor" href="#调试命令" aria-label="Permalink to &quot;调试命令&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看系统日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs/app.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kws</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 监控性能</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">top</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pgrep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;python main.py&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试音频设备</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;import sounddevice as sd; print(sd.query_devices())&quot;</span></span></code></pre></div><h2 id="高级配置" tabindex="-1">高级配置 <a class="header-anchor" href="#高级配置" aria-label="Permalink to &quot;高级配置&quot;">​</a></h2><h3 id="环境适配" tabindex="-1">环境适配 <a class="header-anchor" href="#环境适配" aria-label="Permalink to &quot;环境适配&quot;">​</a></h3><h4 id="安静环境-办公室" tabindex="-1">安静环境（办公室） <a class="header-anchor" href="#安静环境-办公室" aria-label="Permalink to &quot;安静环境（办公室）&quot;">​</a></h4><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;WAKE_WORD_OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_THRESHOLD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_SCORE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;MAX_ACTIVE_PATHS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="嘈杂环境-开放空间" tabindex="-1">嘈杂环境（开放空间） <a class="header-anchor" href="#嘈杂环境-开放空间" aria-label="Permalink to &quot;嘈杂环境（开放空间）&quot;">​</a></h4><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;WAKE_WORD_OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_THRESHOLD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;KEYWORDS_SCORE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;MAX_ACTIVE_PATHS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="与aec集成" tabindex="-1">与AEC集成 <a class="header-anchor" href="#与aec集成" aria-label="Permalink to &quot;与AEC集成&quot;">​</a></h3><p>语音唤醒与回声消除（AEC）完美集成：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;AEC_OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;ENABLED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// AEC为唤醒词提供干净音频</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;ENABLE_PREPROCESS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // 噪声抑制提升检测准确性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;WAKE_WORD_OPTIONS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;USE_WAKE_WORD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         // 使用AEC处理后的音频</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="性能基准" tabindex="-1">性能基准 <a class="header-anchor" href="#性能基准" aria-label="Permalink to &quot;性能基准&quot;">​</a></h3><p>在标准配置下的预期性能：</p><table tabindex="0"><thead><tr><th>指标</th><th>目标值</th><th>说明</th></tr></thead><tbody><tr><td><strong>响应延迟</strong></td><td>&lt; 1秒</td><td>从说话到检测完成</td></tr><tr><td><strong>检测准确率</strong></td><td>&gt; 95%</td><td>正确识别设定唤醒词</td></tr><tr><td><strong>误检率</strong></td><td>&lt; 5%</td><td>错误触发频率</td></tr><tr><td><strong>CPU占用</strong></td><td>&lt; 30%</td><td>持续运行时的资源消耗</td></tr><tr><td><strong>内存占用</strong></td><td>&lt; 100MB</td><td>模型和缓冲区内存使用</td></tr></tbody></table><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p><strong>Sherpa-ONNX 语音唤醒功能特点</strong>:</p><ul><li><strong>高精度</strong>: 基于深度学习的端到端检测</li><li><strong>低延迟</strong>: 毫秒级响应速度</li><li><strong>低资源</strong>: 轻量级模型，适合PC运行</li><li><strong>可定制</strong>: 支持自定义唤醒词</li><li><strong>易集成</strong>: 与现有音频处理完美融合</li></ul><p>现在你可以享受智能、快速、准确的语音唤醒体验了！</p>`,98)]))}const g=i(h,[["render",l]]);export{E as __pageData,g as default};
